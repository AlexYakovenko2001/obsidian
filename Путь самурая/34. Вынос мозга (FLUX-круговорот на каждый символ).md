[[Samurai way]]
### Вынос мозга (FLUX-круговорот на каждый символ)
**Theory:**
Каждое изменение UI должно быть вызвано новыми пропсами, приходящими в компоненту. Если пропсы не изменились, то и UI не имеет права меняться. Например, на данный момент мы печатаем в поле ввода текст нового поста, потом нажимаем кнопку и пост добавляется на стену. Но когда что-то напечатано внутри поля ввода - это уже изменение UI, а ведь стейт обновляется только в момент нажатия кнопки "Add post". То есть сам процесс впечатывания происходит сам по себе, UI меняется внутри себя, а не в зависимости от пропсов. На этом уроке как раз этим и будем заниматься. 
Идея такая:
- мы нажимаем на кнопку на клавиатуре;
- перед тем, как увидеть нажатую букву в поле ввода она должна попасть в стейт, изменить стейт, и только потом отобразиться внутри поля ввода, прийдя из обновленных пропсов, а не возникнув внутри UI
**Actions:**
1. Cоздаём обработчик на **onChange** для поля ввода, которое используется для добавления постов. Назовём его, например **onPostChange**.
2. Также добавляем в качестве **value** для поля ввода то, что будет приходить нам из пропсов и отображаться внутри поля. То есть мы нажимаем кнопку, обработчик на **onChange** срабатывает и отправляет нажатую букву в стейт, обновляет стейт, в компоненту приходит новый стейт, реакт её перерисовывает и внутри поля ввода появляется напечатанная нами буква, но всё это происходит за доли секунды, поэтому визуальной задержки между нажатием клавиши и появлением внутри поля ввода буквы не происходит.![[Pasted image 20221003161115.png]]
3. Создаём внутри объекта **state.profilePage** новое свойство **newPostText** и его значение изначально будет равно пустой строке: ![[Pasted image 20221003164908.png]]
4. Дальше прокидываем **newPostText** через пропсы к компоненте **MyPosts** (для этого нужно будет прокидывать его шаг за шагом через все компоненты, начиная от *Арр* и до *MyPosts* по всему дереву), вносим его в качестве **value** для поля ввода.
5. Cоздаём внутри файла **state.ts** функцию **updateNewPostText**, внутри которой будет код, изменяющий значение **state.profilePage.newPostText** и перерисовывающий всё приложение. ![[Pasted image 20221003165536.png]]
6. Прокидываем её через пропсы до компоненты **MyPosts** и вызываем внутри обработчика, повешенного на **onChange**. 
7. Теперь всё работает, но значение, введённое в поле ввода, не исчезает после нажатия на кнопку "Add post". Т.к. раньше мы его зануляли путём прямого воздействия на реф, а сейчас значение поля ввода зависит от того, что придёт к нему в пропсах. Поэтому для зачистки после отправки можно вызвать функцию **updateNewPostText** внутри функции-обработчика на **onClick**. ![[Pasted image 20221003171944.png]]
8. Теперь внутри **newPostText** будет находиться то, что вводится в поле ввода. То есть уже нет необходимости отправлять в функцию **addPost** напечатанное в поле ввода слово. Это слово и так уже будет находиться внутри объекта **state**, в котором на данный момент хранятся все данные.