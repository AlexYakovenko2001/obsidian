[[Samurai way]]
### Добавление поста на стену
**Theory:**
Сейчас мы рендерим наше приложение единожды при запуске в **index.tsx**, а нам нужно запускать перерисовку при каждом изменении стейта. Для этого тот код, который вызывает перерисовку, нужно обернуть функцией, которая будет дальше вызывать перерисовку столько раз, сколько потребуется.
**Actions:**
1. Создаём внутри файла **index.tsx** функцию **rerenderEntireTree**, в которую закидываем весь код, находящийся в файле, вызывающий перерисовку(нужно помнить, что сейчас это делается для того, чтобы приложение работало и перерисовывалось при изменениях стейта, в дальнейшем это нужно будет фиксить, чтобы перерисовывалась конкретная часть страницы, а не всё приложение). Выглядит примерно так: ![[Pasted image 20221001202614.png]]
2. Дальше нам нужно запускать эту функцию только тогда, когда происходит перерисовка стейта. Для этого функцию нужно вызывать и внутри **state.ts**. Однако из **state.ts** в **index.tsx** уже проимпортирован сам стейт, если теперь из индекса проимпортировать в стейт функцию, то получится циклическая зависимость. Этого допускать нельзя. ![[Pasted image 20221001203025.png]]
3. Так как требуется что-то общее для двух файлов,а импортировать из одного в другой не получается, то можно просто создать третий файл и из него уже без проблем проимпортировать нашу функцию туда, где она будет нужна.
4. Создаём новый файл **render.tsx**, куда переносим весь код, который заставлял наше приложение перерисовываться.
5. Далее уже вызываем функцию **rerenderEntireTree** внутри **state.tsx**
6. Но возникает та же проблема. Сейчас стейт импортируется в **render.tsx** из **state.ts**, а функция **rerenderEntireTree** будет импортироваться из **render.tsx** в **state.ts**. Снова получилась циклическая зависимость.
7. Решить это можно просто добавив в параметры функции стейт. И уже тот, кто будет её вызывать, будет у себя закидывать стейт в качестве параметра. Выглядит это так: ![[Pasted image 20221003072013.png]]
Получается такая схема: ![[Pasted image 20221003072709.png]]
8. Далее вызываем функцию **rerenderEntireTree** внутри функции, которая отвечает за добавление поста на стену и вызываем её также внутри **index.tsx**